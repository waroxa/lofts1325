import{x as c,o as g,c as S,a as y,t as f,C as p,m as h,y as $,b as k,Y as A}from"./js/runtime-dom.esm-bundler.h3wlw8jh.js";import{l as C}from"./js/index.lee45600.js";import{a as I,l as N}from"./js/index.h6q9ey6x.js";import{l as q}from"./js/index.moogjen0.js";import{l,c as L,H as u,a as D,F,G as V}from"./js/index.ms17x8jb.js";import{e as H}from"./js/elemLoaded.f718isk5.js";import{s as M}from"./js/metabox.ejlpgbw1.js";import{C as Q}from"./js/Tooltip.i4ssodi5.js";import"./js/translations.b896ab1m.js";import{_ as v}from"./js/_plugin-vue_export-helper.oebm7xum.js";import{a as U}from"./js/toString.dd8wo7ge.js";import{b as O}from"./js/_baseIteratee.o2a026yk.js";import{b as R}from"./js/_basePickBy.cul3h6zn.js";import{g as z}from"./js/_getAllKeysIn.zqxbvqi0.js";import{a as _,_ as T}from"./js/default-i18n.hohxoesu.js";import"./js/Caret.mmz7e9vd.js";import"./js/helpers.dyu2l85l.js";import"./js/_baseIsEqual.hvlfp2dq.js";import"./js/_getTag.i5tbt0nk.js";import"./js/_baseSet.ifi8fiaf.js";function G(e,t){if(e==null)return{};var o=U(z(e),function(r){return[r]});return t=O(t),R(e,o,function(r,s){return t(r,s[0])})}const E={getTerms:async e=>{const{apiFetch:t}=window.wp,{addQueryArgs:o}=window.wp.url,r=m(e);return await t({path:o(`/wp/v2/${r.restBase}`,{per_page:-1,orderby:"count",order:"desc",_fields:"id,name"})})},getSelectedTerms:e=>{const t=m(e);return window.wp.data.select("core/editor").getEditedPostAttribute(t.restBase)||[]}},P={getTerms:async e=>{var s;const t=[],o=m(e);return(((s=document.getElementById(`${o.name}checklist`))==null?void 0:s.querySelectorAll("li"))||[]).forEach(n=>{const a=n.querySelector("input").value,i=n.querySelector("label").innerText;t.push({id:parseInt(a,10),name:i.trim()})}),new Promise(n=>{n(t)})},getSelectedTerms:e=>{var s;const t=[],o=m(e);return(((s=document.getElementById(`${o.name}checklist`))==null?void 0:s.querySelectorAll("input:checked"))||[]).forEach(n=>{t.push(parseInt(n.value,10))}),t}},d=()=>{var o;return l(),(((o=L().aioseo.postData)==null?void 0:o.taxonomies)||[]).filter(r=>r.primaryTermSupport===!0)},K=e=>d().some(t=>e===t.name),m=e=>{const t=d().filter(o=>e===o.name);return t.length?t[0]:{}},Y=e=>u()?E.getTerms(e):P.getTerms(e),J=e=>u()?E.getSelectedTerms(e):P.getSelectedTerms(e),w="aioseo-pro",W={setup(){return{postEditorStore:D()}},components:{CoreTooltip:Q,SvgCircleQuestionMark:I},props:{taxonomy:String},data(){return{term:null,terms:[],selectedTerms:[]}},watch:{terms(e){if(!this.term&&e&&this.postEditorStore.currentPost.primary_term[this.taxonomy]){const t=e.find(o=>o.value===this.postEditorStore.currentPost.primary_term[this.taxonomy]);this.setPrimaryTerm(t)}},selectedTerms(e,t){if(t.length<e.length){const o=e.filter(r=>!t.includes(r))[0];this.terms.some(r=>r.value===o)||this.updateTerms()}this.term&&this.term.value&&!e.includes(this.term.value)&&this.setPrimaryTerm(null)}},computed:{taxonomyName(){return m(this.taxonomy).singular},toolTipText(){return _(T("%1$s allows you to choose a primary %2$s for your posts. This feature works hand in hand with our powerful Breadcrumbs template to give you full navigational control to help improve your search rankings.",w),"AIOSEO Pro",this.taxonomyName)},labelString(){return _(T("Select Primary %1$s",w),this.taxonomyName)},options(){return this.terms.filter(e=>this.selectedTerms.includes(e.value))}},methods:{setPrimaryTerm(e){this.term=e,window.aioseoBus.$emit("standalone-update-post",{primary_term:G({...this.postEditorStore.currentPost.primary_term,[this.taxonomy]:e&&e.value?e.value:null})})},updateTerms(){Y(this.taxonomy).then(e=>{this.terms=[],e.forEach(t=>{this.terms.push({value:t.id,label:t.name})})})},updateSelectedTerms(){this.selectedTerms=J(this.taxonomy)}},mounted(){this.updateTerms(),this.updateSelectedTerms(),window.aioseoBus.$on("updateSelectedTerms",this.updateSelectedTerms)},beforeUnmount(){window.aioseoBus.$off("updateSelectedTerms",this.updateSelectedTerms)}},X={key:0,class:"aioseo-primary-term-select"},Z={class:"aioseo-primary-term-select__title"},j={class:"aioseo-primary-term-select__title-text"};function ee(e,t,o,r,s,n){const a=c("svg-circle-question-mark"),i=c("core-tooltip"),b=c("base-select");return 1<s.selectedTerms.length?(g(),S("div",X,[y("div",Z,[y("span",j,f(n.labelString),1),p(i,{offset:"-200px,0"},{tooltip:h(()=>[$(f(n.toolTipText),1)]),default:h(()=>[p(a)]),_:1})]),p(b,{size:"medium",options:n.options,modelValue:s.term,"onUpdate:modelValue":t[0]||(t[0]=B=>n.setPrimaryTerm(B))},null,8,["options","modelValue"])])):k("",!0)}const te=v(W,[["render",ee]]),oe={components:{PrimaryTerm:te},props:{taxonomy:String}},re={class:"aioseo-app aioseo-primary-term"};function se(e,t,o,r,s,n){const a=c("primary-term");return g(),S("div",re,[p(a,{taxonomy:o.taxonomy},null,8,["taxonomy"])])}const ne=v(oe,[["render",se]]);if(u()&&window.wp){const{createElement:e,Fragment:t}=window.wp.element,{addFilter:o}=window.wp.hooks,{createHigherOrderComponent:r}=window.wp.compose,{subscribe:s}=window.wp.data;o("editor.PostTaxonomyType","aioseo/primary-term",r(n=>a=>{const{slug:i}=a;return K(i)?e(t,{},e(n,a),e("div",{id:`aioseo-primary-term-${i}`},e("div",{className:"aioseo-primary-term-app",taxonomy:i}))):e(n,a)},"withInspectorControls")),s(()=>{window.aioseoBus.$emit("updateSelectedTerms")})}(F()||V())&&(l(),d().forEach(e=>{var r;const t=(r=document.getElementById(`${e.name}div`))==null?void 0:r.querySelector(".inside");if(!t)return;const o=document.createElement("div");o.setAttribute("id",`aioseo-primary-term-${e.name}`),o.setAttribute("class","aioseo-primary-term-app"),o.setAttribute("taxonomy",e.name),t.append(o),function(s){s(`#${e.name}checklist`).on("change",'input[type="checkbox"]',()=>{window.aioseoBus.$emit("updateSelectedTerms")}),s(`#${e.name}checklist`).on("wpListAddEnd",()=>{window.aioseoBus.$emit("updateSelectedTerms")})}(window.jQuery)}));const x=e=>{if(!e)return;const t=e.getAttribute("taxonomy");let o=A({...ne,name:"Standalone/PrimaryTerm"},{taxonomy:t});o=C(o),o=N(o),o=q(o),l(o),o.mount(e)};if(M()&&window.aioseo&&window.aioseo.currentPost&&window.aioseo.currentPost.context==="post"){const e=document.getElementsByClassName("aioseo-primary-term-app");Array.prototype.forEach.call(e,t=>x(t)),H(".aioseo-primary-term-app","aioseoPrimaryTerm"),document.addEventListener("animationstart",function(t){t.animationName==="aioseoPrimaryTerm"&&x(t.target)},{passive:!0})}
