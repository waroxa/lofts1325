{"version":3,"file":"license.js","mappings":"mBAEAA,SAASC,iBAAiB,oBAAoB,WAC5C,MAAMC,EAAiBF,SAASG,cAAc,uBACxB,IAAIC,EAAeF,EAAgB,CACvDG,SAAU,CAAC,YAAa,SACxBC,OAAQ,QAEZ,IAEA,MAAMF,EACJG,WAAAA,CAAYC,EAAOC,EAAU,CAAC,GAC5B,IAAKD,EAEH,YADAE,QAAQC,MAAM,mBAGhB,MAAM,SAAEN,EAAW,GAAE,OAAEC,GAAWG,EAClCG,KAAKC,UAAqC,cAAzBC,OAAOC,SAASC,KAAuB,4BAA8B,wBAA0B,8BAChHJ,KAAKN,OAASA,EACdM,KAAKJ,MAAQA,EAEb,MAAMS,EAASjB,SAASG,cAAc,IAAIS,KAAKN,uBACzCY,EAASV,EAAML,cAAc,WAC7BgB,EAAQX,EAAML,cAAc,UAC5BiB,EAAcZ,EAAML,cAAc,iBAClCkB,EAAgBb,EAAML,cAAc,mBACpCmB,EAASd,EAAML,cAAc,eACnCS,KAAKW,QAAU,CAAE,eAAgB,oBAGjCN,GAAQhB,iBAAiB,SAAUuB,IACjCA,EAAEC,iBACFjB,EAAMkB,MAAMC,QAAU,OAAO,IAG/BT,GAAQjB,iBAAiB,SAAUuB,IACjCA,EAAEC,iBACFjB,EAAMkB,MAAMC,QAAU,MAAM,IAG9BR,GAAOlB,iBAAiB,SAAS,WAC/BmB,EAAYQ,UAAYT,GAAOU,OACjC,IAEAT,GAAanB,iBAAiB,SAAS6B,UACrCN,EAAEC,iBACFH,EAAOI,MAAMC,QAAU,eACvBP,EAAYQ,UAAW,EACvB,MAAMG,EAAQvB,EAAML,cAAc,qBAClC,GAAI4B,GAAOC,MAAO,OACOpB,KAAKqB,cAAcF,GAAOC,MAAO3B,IAEtDO,KAAKsB,UAAU,iBAAkB,+BAKrC,MACEtB,KAAKsB,UAAU,iBAAkB,8BAGnCd,EAAYQ,UAAW,EACvBN,EAAOI,MAAMC,QAAU,MAAM,IAG/BN,GAAepB,iBAAiB,SAAS6B,UACvCN,EAAEC,iBACFH,EAAOI,MAAMC,QAAU,eACvBN,EAAcO,UAAW,EAEzB,MAAMG,EAAQvB,EAAML,cAAc,qBAClC,GAAI4B,GAAOC,MAAO,OACSpB,KAAKuB,gBAAgBJ,GAAOC,MAAO3B,IAE1DO,KAAKsB,UAAU,iBAAkB,2BAErC,CAEAb,EAAcO,UAAW,EACzBN,EAAOI,MAAMC,QAAU,MAAM,GAEjC,CAEAS,cAAgBN,MAAOzB,EAAW,GAAIgC,KACpC,IAAIC,EAAW,CAAC,EAChB,IAAK,IAAIC,KAAWlC,EAAU,CAC5B,IAAImC,QAAYC,MAAM,6CAA8C,CAClEC,OAAQ,OACRnB,QAAS,CAAE,eAAgB,oBAC3BoB,KAAMC,KAAKC,UAAU,CAAEC,kBAAmBP,EAASQ,YAAaV,MAE/DW,MAAMR,GAAQA,EAAIS,SAClBD,MAAMR,GAAQA,IACjB,GAAIA,EAAIU,QAAS,CACfZ,EAAWE,EACX,KACF,CACF,CACA,MAAMW,EAAWvC,KAAKwC,YAAYd,GAC5Be,EAAYf,GAAUgB,UAAUC,cAAcC,SAAS,UAAW,EAClEC,EAAYnB,GAAUgB,UAAUG,UACtC,MAAO,CAAEN,WAAUD,QAASZ,EAASY,QAASO,YAAWJ,YAAW,EAGtEK,cAAgB5B,UACd,MAAM6B,EAAO,CACXR,SAAU,EACVS,QAAS9C,OAAOC,UAAU8C,OAC1BtB,QAAS,YACTuB,MAAOC,aAAaD,MACpBE,OAAQ,SACLC,GAaL,aAVuBxB,MAAM7B,KAAKC,SAAU,CAC1C6B,OAAQ,OACRnB,QAAS,CACP,eAAgB,oBAElBoB,KAAMC,KAAKC,UAAUc,KAEpBX,MAAMR,GAAQA,EAAIS,SAClBD,MAAMR,GAAQA,GAEF,EAGjBP,cAAgBH,MAAOiB,EAAa1C,KAClC,MAAM,UAAEoD,EAAS,QAAEP,EAAO,SAAEC,EAAQ,UAAEE,SAAoBzC,KAAKwB,cAAc/B,EAAU0C,GACvF,GAAIG,EAAS,CACX,MAAM,OAAEgB,EAAM,QAAEC,SAAkBvD,KAAK8C,cAAc,CAAEX,cAAaI,WAAUE,cAC9E,GAAIa,EAAQ,CACV,MAAMP,EAAO,IAAIS,SACjBT,EAAKU,OAAO,SAAU,2BACtBV,EAAKU,OAAO,YAAa,GACzBV,EAAKU,OAAO,cAAetB,GAE3B,MAAMuB,QAAuB7B,MAAMsB,aAAaQ,QAAS,CACvD7B,OAAQ,OACRC,KAAMgB,IAELX,MAAMR,GAAQA,EAAIS,SAClBD,MAAMR,GAAQA,IACjB,OAAO8B,GAAgBpB,OACzB,CACEtC,KAAKsB,UAAU,iBAAkBiC,EAErC,MACEvD,KAAKsB,UAAU,iBAAkB,sBACnC,EAGFC,gBAAkBL,MAAOiB,EAAa1C,KACpC,MAAM,UAAEoD,EAAS,QAAEP,EAAO,SAAEC,EAAQ,UAAEE,SAAoBzC,KAAKwB,cAAc/B,EAAU0C,GAEvF,GAAIG,EAAS,CAEX,SAD0BtC,KAAK8C,cAAc,CAAEX,cAAaiB,OAAQ,aACnD,CACf,MAAML,EAAO,IAAIS,SACjBT,EAAKU,OAAO,SAAU,2BACtBV,EAAKU,OAAO,YAAa,GACzBV,EAAKU,OAAO,cAAe,IAE3B,MAAMG,QAAmB/B,MAAMsB,aAAaQ,QAAS,CACnD7B,OAAQ,OACRC,KAAMgB,IAELX,MAAMR,GAAQA,EAAIS,SAClBD,MAAMR,GAAQA,IACjB,OAAOgC,GAAYtB,OACrB,CACEtC,KAAKsB,UAAU,iBAAkB,wBAErC,MACEtB,KAAKsB,UAAU,iBAAkB,uBACnC,EAGFA,SAAAA,CAAUuC,EAASC,GACjB,MAAMC,EAAe/D,KAAKJ,MAAML,cAAc,mBACxCyE,EAAS5E,SAAS6E,cAAc,OACtCD,EAAOE,UAAY,UAAUL,IAC7BG,EAAOG,UAAYL,EACnBC,EAAaK,YAAYJ,GACzBK,YAAW,KACTL,EAAOM,SACQ,kBAAXT,GACF1D,SAASoE,QACX,GACC,KAEHF,YAAW,KACM,kBAAXR,GACF1D,SAASoE,QACX,GACC,IAEL,CAEA/B,YAAed,IACI,CACf,gBAAiB,EACjB,YAAa,EACb,YAAa,EACb,2BAA4B,IAC5B,cAAe,KAEOA,GAAUgB,UAAU8B,WAAa,G","sources":["webpack://pdf-poster-pro/./src/license.js"],"sourcesContent":["import \"./license.scss\";\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", function () {\r\n  const licenseWrapper = document.querySelector(\".pdfp_license_popup\");\r\n  const activeLicense = new LicenseHandler(licenseWrapper, {\r\n    products: [\"pdfposter\", \"uoGmX\"],\r\n    prefix: \"pdfp\",\r\n  });\r\n});\r\n\r\nclass LicenseHandler {\r\n  constructor(modal, options = {}) {\r\n    if (!modal) {\r\n      console.error(\"modal undefined\");\r\n      return;\r\n    }\r\n    const { products = [], prefix } = options;\r\n    this.endpoint = (window.location.host === \"localhost\" ? \"http://localhost/freemius\" : \"https://bplugins.com\") + \"/wp-json/license/v1/gumroad\";\r\n    this.prefix = prefix;\r\n    this.modal = modal;\r\n\r\n    const opener = document.querySelector(`.${this.prefix}_modal_opener`); //mpafe_modal_opener\r\n    const closer = modal.querySelector(\".closer\");\r\n    const agree = modal.querySelector(\".agree\");\r\n    const activateBtn = modal.querySelector(\".btn-activate\");\r\n    const deactivateBtn = modal.querySelector(\".btn-deactivate\");\r\n    const loader = modal.querySelector(\".bpl_loader\");\r\n    this.headers = { \"content-Type\": \"application/json\" };\r\n    // this.checking = false;\r\n\r\n    opener?.addEventListener(\"click\", (e) => {\r\n      e.preventDefault();\r\n      modal.style.display = \"block\";\r\n    });\r\n\r\n    closer?.addEventListener(\"click\", (e) => {\r\n      e.preventDefault();\r\n      modal.style.display = \"none\";\r\n    });\r\n\r\n    agree?.addEventListener(\"click\", function () {\r\n      activateBtn.disabled = !agree?.checked;\r\n    });\r\n\r\n    activateBtn?.addEventListener(\"click\", async (e) => {\r\n      e.preventDefault();\r\n      loader.style.display = \"inline-block\";\r\n      activateBtn.disabled = true;\r\n      const field = modal.querySelector(\"input.license_key\");\r\n      if (field?.value) {\r\n        const activate = await this.activeLicense(field?.value, products);\r\n        if (activate) {\r\n          this.setNotice(\"notice-success\", \"Plugin Activated!, Thank you\");\r\n        }\r\n        //  else {\r\n        //   this.setNotice(\"notice-warning\", \"Something went wrong!\");\r\n        // }\r\n      } else {\r\n        this.setNotice(\"notice-warning\", \"Please input a license key\");\r\n      }\r\n\r\n      activateBtn.disabled = false;\r\n      loader.style.display = \"none\";\r\n    });\r\n\r\n    deactivateBtn?.addEventListener(\"click\", async (e) => {\r\n      e.preventDefault();\r\n      loader.style.display = \"inline-block\";\r\n      deactivateBtn.disabled = true;\r\n\r\n      const field = modal.querySelector(\"input.license_key\");\r\n      if (field?.value) {\r\n        const deactivate = await this.deactiveLicense(field?.value, products);\r\n        if (deactivate) {\r\n          this.setNotice(\"notice-success\", \"License key deactivated.\");\r\n        }\r\n      }\r\n\r\n      deactivateBtn.disabled = false;\r\n      loader.style.display = \"none\";\r\n    });\r\n  }\r\n\r\n  verifyGumroad = async (products = [], key) => {\r\n    let response = {};\r\n    for (let product of products) {\r\n      let res = await fetch(\"https://api.gumroad.com/v2/licenses/verify\", {\r\n        method: \"POST\",\r\n        headers: { \"content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ product_permalink: product, license_key: key }),\r\n      })\r\n        .then((res) => res.json())\r\n        .then((res) => res);\r\n      if (res.success) {\r\n        response = res;\r\n        break;\r\n      }\r\n    }\r\n    const quantity = this.getQuantity(response);\r\n    const isAppSumo = response?.purchase?.product_name?.includes(\"Sumo\") || false;\r\n    const permalink = response?.purchase?.permalink;\r\n    return { quantity, success: response.success, permalink, isAppSumo };\r\n  };\r\n\r\n  serverHandler = async (params) => {\r\n    const data = {\r\n      quantity: 1,\r\n      website: window.location?.origin,\r\n      product: \"pdfposter\",\r\n      email: pdfpLicense?.email,\r\n      action: \"add\",\r\n      ...params,\r\n    };\r\n\r\n    const response = await fetch(this.endpoint, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify(data),\r\n    })\r\n      .then((res) => res.json())\r\n      .then((res) => res);\r\n\r\n    return response;\r\n  };\r\n\r\n  activeLicense = async (license_key, products) => {\r\n    const { permalink, success, quantity, isAppSumo } = await this.verifyGumroad(products, license_key);\r\n    if (success) {\r\n      const { active, message } = await this.serverHandler({ license_key, quantity, isAppSumo });\r\n      if (active) {\r\n        const data = new FormData();\r\n        data.append(\"action\", \"pdfp_active_license_key\");\r\n        data.append(\"activated\", 1);\r\n        data.append(\"license_key\", license_key);\r\n\r\n        const activatePlugin = await fetch(pdfpLicense?.ajaxUrl, {\r\n          method: \"POST\",\r\n          body: data,\r\n        })\r\n          .then((res) => res.json())\r\n          .then((res) => res);\r\n        return activatePlugin?.success;\r\n      } else {\r\n        this.setNotice(\"notice-warning\", message);\r\n      }\r\n    } else {\r\n      this.setNotice(\"notice-warning\", \"Invalid License key\");\r\n    }\r\n  };\r\n\r\n  deactiveLicense = async (license_key, products) => {\r\n    const { permalink, success, quantity, isAppSumo } = await this.verifyGumroad(products, license_key);\r\n\r\n    if (success) {\r\n      const deactivated = await this.serverHandler({ license_key, action: \"deactive\" });\r\n      if (deactivated) {\r\n        const data = new FormData();\r\n        data.append(\"action\", \"pdfp_active_license_key\");\r\n        data.append(\"activated\", 0);\r\n        data.append(\"license_key\", \"\");\r\n\r\n        const deactivate = await fetch(pdfpLicense?.ajaxUrl, {\r\n          method: \"POST\",\r\n          body: data,\r\n        })\r\n          .then((res) => res.json())\r\n          .then((res) => res);\r\n        return deactivate?.success;\r\n      } else {\r\n        this.setNotice(\"notice-warning\", \"something went wrong!\");\r\n      }\r\n    } else {\r\n      this.setNotice(\"notice-warning\", \"invalid license key!\");\r\n    }\r\n  };\r\n\r\n  setNotice(classes, noticeText) {\r\n    const noticeParent = this.modal.querySelector(\".license_notice\");\r\n    const notice = document.createElement(\"div\");\r\n    notice.classList = `notice ${classes}`;\r\n    notice.innerText = noticeText;\r\n    noticeParent.appendChild(notice);\r\n    setTimeout(() => {\r\n      notice.remove();\r\n      if (classes == \"notice-success\") {\r\n        location.reload();\r\n      }\r\n    }, 3000);\r\n\r\n    setTimeout(() => {\r\n      if (classes == \"notice-success\") {\r\n        location.reload();\r\n      }\r\n    }, 1000);\r\n    return;\r\n  }\r\n\r\n  getQuantity = (response) => {\r\n    const variants = {\r\n      \"(Single Site)\": 1,\r\n      \"(3 Sites)\": 3,\r\n      \"(5 Sites)\": 5,\r\n      \"(Developer  - Unlimited)\": 1000,\r\n      \"(Developer)\": 1000,\r\n    };\r\n    let quantity = variants[response?.purchase?.variants] || 1;\r\n\r\n    return quantity;\r\n  };\r\n}\r\n\r\nexport default LicenseHandler;\r\n"],"names":["document","addEventListener","licenseWrapper","querySelector","LicenseHandler","products","prefix","constructor","modal","options","console","error","this","endpoint","window","location","host","opener","closer","agree","activateBtn","deactivateBtn","loader","headers","e","preventDefault","style","display","disabled","checked","async","field","value","activeLicense","setNotice","deactiveLicense","verifyGumroad","key","response","product","res","fetch","method","body","JSON","stringify","product_permalink","license_key","then","json","success","quantity","getQuantity","isAppSumo","purchase","product_name","includes","permalink","serverHandler","data","website","origin","email","pdfpLicense","action","params","active","message","FormData","append","activatePlugin","ajaxUrl","deactivate","classes","noticeText","noticeParent","notice","createElement","classList","innerText","appendChild","setTimeout","remove","reload","variants"],"sourceRoot":""}